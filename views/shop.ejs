<%- include('./partials/headerShop') %>

    <% if(success.length>0){ %>
            <div class="fixed top-24 left-1/2 -translate-x-1/2 z-50 p-4 rounded-lg bg-green-500 shadow-lg animate-bounce">
                <span class="inline-block text-white font-medium">
                    <%= success %>
                </span>
            </div>
            <% } %>
            
            <div class="w-full min-h-screen flex items-start px-4 sm:px-10 py-24 bg-gray-50">
                <!-- Sidebar -->
                <div class="w-[20%] hidden md:flex flex-col items-start sticky top-24 h-[calc(100vh-6rem)] overflow-y-auto pr-6 border-r border-gray-200">
                    <div class="w-full mb-8">
                        <h3 class="text-sm font-bold text-gray-400 uppercase tracking-wider mb-3">Sort by</h3>
                        <form action="/shop" class="w-full">
                            <select class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white text-gray-700 text-sm transition-shadow" name="sortby" onchange="this.form.submit()">
                                <option value="popular">Popular</option>
                                <option value="newest">Newest</option>
                            </select>
                        </form>
                    </div>
                    
                    <div class="w-full mb-8">
                        <h3 class="text-sm font-bold text-gray-400 uppercase tracking-wider mb-3">Categories</h3>
                        <a class="block w-full py-2 px-3 rounded-lg hover:bg-gray-200 text-gray-700 font-medium transition-all duration-200" href="/shop">All Products</a>
                    </div>

                    <div class="w-full">
                        <h3 class="text-sm font-bold text-gray-400 uppercase tracking-wider mb-3">Filter by</h3>
                        <div class="space-y-1">
                            <a class="block w-full py-2 px-3 rounded-lg hover:bg-gray-200 text-gray-700 font-medium transition-all duration-200" href="/shop?filter=availability">Availability</a>
                            <a class="block w-full py-2 px-3 rounded-lg hover:bg-gray-200 text-gray-700 font-medium transition-all duration-200" href="/shop?filter=discount">Discount</a>
                        </div>
                    </div>
                </div>

                <!-- Main Content -->
                <div class="w-full md:w-[80%] flex flex-col gap-5 pl-0 md:pl-8">
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                        <% products.forEach((product)=>{ %>
                            <div class="group relative bg-white rounded-xl overflow-hidden shadow-sm hover:shadow-xl transition-all duration-300 border border-gray-100 flex flex-col h-full">
                                <!-- Image Section -->
                                <div class="w-full h-64 flex items-center justify-center bg-[<%= product.bgcolor %>] relative overflow-hidden">
                                    <img class="h-48 object-contain drop-shadow-md group-hover:scale-110 transition-transform duration-500" 
                                         src="data:image/<%=product.imgType%>;base64,<%= product.img.toString('base64') %>"
                                         alt="<%= product.name %>">
                                </div>
                                
                                <!-- Details Section -->
                                <div class="p-4 flex flex-col flex-grow bg-[<%= product.panelcolor %>] text-[<%= product.textcolor %>] transition-colors">
                                    <div class="flex justify-between items-start mb-2">
                                        <h3 class="text-lg font-semibold leading-tight truncate pr-2" title="<%= product.name %>"><%= product.name %></h3>
                                        <a class="w-8 h-8 flex-shrink-0 flex items-center justify-center rounded-full bg-white text-gray-800 shadow-sm hover:bg-black hover:text-white transition-all duration-200" href="/addtocart/<%=product._id%>">
                                            <i class="ri-add-line text-xl"></i>
                                        </a>
                                    </div>
                                    
                                    <div class="mt-auto flex items-baseline gap-2">
                                        <h4 class="text-xl font-bold">₹ <%= product.price - product.discount %></h4>
                                        <% if(product.discount > 0){ %>
                                            <h4 class="text-sm opacity-60 line-through">₹ <%= product.price %></h4>
                                        <% } %>
                                    </div>
                                </div>
                            </div>
                        <% }) %>
                    </div>
                    
                    <% if(products.length === 0) { %>
                        <div class="w-full h-64 flex flex-col items-center justify-center text-gray-400">
                            <i class="ri-shopping-bag-3-line text-6xl mb-4 opacity-50"></i>
                            <p class="text-xl font-medium">No products found.</p>
                        </div>
                    <% } %>
                </div>
            </div>
            <%- include('./partials/footer') %>